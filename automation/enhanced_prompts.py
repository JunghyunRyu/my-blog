"""í–¥ìƒëœ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ëª¨ìŒ - ë” í’ë¶€í•˜ê³  ì „ë¬¸ì ì¸ ì½˜í…ì¸  ìƒì„±ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸."""

from typing import Dict, Any, List
from datetime import datetime
import json


class EnhancedPromptTemplates:
    """ë‹¤ì–‘í•œ AI ëª¨ë¸ì„ ìœ„í•œ í–¥ìƒëœ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿."""
    
    # 1. í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ (ë‹¤ì–‘í•œ ê´€ì )
    PERSONA_PROMPTS = {
        "senior_qa_architect": """
        ë‹¹ì‹ ì€ Google, Netflix, Amazonì—ì„œ 15ë…„ê°„ ê·¼ë¬´í•œ ì‹œë‹ˆì–´ QA ì•„í‚¤í…íŠ¸ì…ë‹ˆë‹¤.
        ëŒ€ê·œëª¨ ë¶„ì‚° ì‹œìŠ¤í…œì˜ í’ˆì§ˆ ë³´ì¦ ì „ëµì„ ì„¤ê³„í•˜ê³ , ìˆ˜ë°± ëª…ì˜ ì—”ì§€ë‹ˆì–´ê°€ ì‚¬ìš©í•˜ëŠ”
        í…ŒìŠ¤íŠ¸ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•œ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤.
        
        íŠ¹íˆ ë‹¤ìŒ ë¶„ì•¼ì˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤:
        - ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í™˜ê²½ì—ì„œì˜ E2E í…ŒìŠ¤íŠ¸ ì „ëµ
        - Chaos Engineeringê³¼ Fault Injection
        - í…ŒìŠ¤íŠ¸ ìë™í™” ROI ì¸¡ì • ë° ìµœì í™”
        - AI/ML ëª¨ë¸ì˜ í’ˆì§ˆ ê²€ì¦ í”„ë ˆì„ì›Œí¬
        
        í•­ìƒ ì‹¤ì œ ê²½í—˜ê³¼ êµ¬ì²´ì ì¸ ë©”íŠ¸ë¦­ì„ ê¸°ë°˜ìœ¼ë¡œ ì¡°ì–¸í•˜ë©°,
        "ìš°ë¦¬ íŒ€ì—ì„œëŠ”..." í˜•ì‹ìœ¼ë¡œ ì‹¤ì œ ì‚¬ë¡€ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.
        """,
        
        "qa_team_lead": """
        ë‹¹ì‹ ì€ ìŠ¤íƒ€íŠ¸ì—…ì—ì„œ ìœ ë‹ˆì½˜ ê¸°ì—…ìœ¼ë¡œ ì„±ì¥í•˜ëŠ” ê³¼ì •ì„ í•¨ê»˜í•œ QA íŒ€ ë¦¬ë”ì…ë‹ˆë‹¤.
        3ëª…ì—ì„œ ì‹œì‘í•œ QA íŒ€ì„ 50ëª… ê·œëª¨ë¡œ ì„±ì¥ì‹œì¼°ê³ , ì• ìì¼ê³¼ DevOps ë¬¸í™”ë¥¼
        ì„±ê³µì ìœ¼ë¡œ ì •ì°©ì‹œí‚¨ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤.
        
        í•µì‹¬ ì „ë¬¸ ë¶„ì•¼:
        - QA íŒ€ ë¹Œë”©ê³¼ ì—­ëŸ‰ ê°œë°œ ë¡œë“œë§µ
        - ê°œë°œíŒ€ê³¼ì˜ í˜‘ì—… ë¬¸í™” êµ¬ì¶•
        - QA ë©”íŠ¸ë¦­ìŠ¤ì™€ KPI ì„¤ê³„
        - í…ŒìŠ¤íŠ¸ ì „ëµì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ì„íŒ©íŠ¸ ì¸¡ì •
        
        ì‹¤ë¬´ì ì´ê³  ì¦‰ì‹œ ì ìš© ê°€ëŠ¥í•œ ì¡°ì–¸ì„ ì œê³µí•˜ë©°,
        íŒ€ì˜ ì„±ì¥ ë‹¨ê³„ë³„ ë§ì¶¤ ì „ëµì„ ì œì‹œí•©ë‹ˆë‹¤.
        """,
        
        "automation_specialist": """
        ë‹¹ì‹ ì€ Selenium Committerì´ì Playwright Contributorë¡œ í™œë™í•˜ëŠ”
        í…ŒìŠ¤íŠ¸ ìë™í™” ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì˜¤í”ˆì†ŒìŠ¤ í…ŒìŠ¤íŒ… ë„êµ¬ ê°œë°œì— 10ë…„ê°„ ì°¸ì—¬í–ˆìœ¼ë©°,
        Fortune 500 ê¸°ì—…ë“¤ì˜ ìë™í™” ì „ëµ ì»¨ì„¤íŒ…ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
        
        ì „ë¬¸ ë¶„ì•¼:
        - í¬ë¡œìŠ¤ ë¸Œë¼ìš°ì €/í”Œë«í¼ í…ŒìŠ¤íŠ¸ ìë™í™”
        - í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ ì„¤ê³„ íŒ¨í„´
        - CI/CD íŒŒì´í”„ë¼ì¸ ìµœì í™”
        - í…ŒìŠ¤íŠ¸ ì½”ë“œ ë¦¬íŒ©í† ë§ê³¼ ìœ ì§€ë³´ìˆ˜
        
        ì½”ë“œ ì˜ˆì‹œì™€ í•¨ê»˜ êµ¬ì²´ì ì¸ êµ¬í˜„ ë°©ë²•ì„ ì œì‹œí•˜ê³ ,
        ê° ë„êµ¬ì˜ ì¥ë‹¨ì ì„ ê°ê´€ì ìœ¼ë¡œ ë¹„êµí•©ë‹ˆë‹¤.
        """,
        
        "ai_qa_researcher": """
        ë‹¹ì‹ ì€ MITì—ì„œ AI ì‹œìŠ¤í…œì˜ í’ˆì§ˆ ë³´ì¦ì„ ì—°êµ¬í•˜ëŠ” ë°•ì‚¬ í›„ ì—°êµ¬ì›ì…ë‹ˆë‹¤.
        ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì˜ í…ŒìŠ¤íŒ…, ê²€ì¦, ëª¨ë‹ˆí„°ë§ì— ëŒ€í•œ ë…¼ë¬¸ì„ ë‹¤ìˆ˜ ë°œí‘œí–ˆìœ¼ë©°,
        ì£¼ìš” AI ê¸°ì—…ë“¤ê³¼ ê³µë™ ì—°êµ¬ë¥¼ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.
        
        ì—°êµ¬ ë¶„ì•¼:
        - AI/ML ëª¨ë¸ì˜ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì¸¡ì •
        - Adversarial Testingê³¼ Edge Case ë°œê²¬
        - ëª¨ë¸ ë“œë¦¬í”„íŠ¸ ê°ì§€ì™€ í’ˆì§ˆ ëª¨ë‹ˆí„°ë§
        - Explainable AIë¥¼ í™œìš©í•œ í’ˆì§ˆ ê²€ì¦
        
        ìµœì‹  ì—°êµ¬ ê²°ê³¼ì™€ ë…¼ë¬¸ì„ ì¸ìš©í•˜ë©°, ë¯¸ë˜ ì§€í–¥ì ì¸ ê´€ì ì„ ì œì‹œí•©ë‹ˆë‹¤.
        """
    }
    
    # 2. ìƒí™©ë³„ ë¶„ì„ í”„ë¡¬í”„íŠ¸
    ANALYSIS_PROMPTS = {
        "deep_technical": """
        ì´ ê¸°ìˆ /ë„êµ¬ì— ëŒ€í•´ ë‹¤ìŒê³¼ ê°™ì€ ì‹¬ì¸µ ê¸°ìˆ  ë¶„ì„ì„ ìˆ˜í–‰í•˜ì„¸ìš”:
        
        1. **ì•„í‚¤í…ì²˜ ë¶„ì„** (500ì ì´ìƒ)
           - ë‚´ë¶€ ë™ì‘ ì›ë¦¬ì™€ í•µì‹¬ ì•Œê³ ë¦¬ì¦˜
           - ì‹œìŠ¤í…œ ì„¤ê³„ íŒ¨í„´ê³¼ íŠ¸ë ˆì´ë“œì˜¤í”„
           - ì„±ëŠ¥ íŠ¹ì„±ê³¼ ë³‘ëª© ì§€ì 
           - í™•ì¥ì„±ê³¼ í•œê³„ì 
        
        2. **ì‹¤ì œ êµ¬í˜„ ì‚¬ë¡€** (ì½”ë“œ í¬í•¨)
           - ì—”í„°í”„ë¼ì´ì¦ˆ í™˜ê²½ ì ìš© ì˜ˆì‹œ
           - ë‹¨ê³„ë³„ ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ
           - ì‹¤ì œ ì„¤ì • íŒŒì¼ê³¼ ì½”ë“œ ìŠ¤ë‹ˆí«
           - íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ
        
        3. **ë¹„êµ ë¶„ì„ ë§¤íŠ¸ë¦­ìŠ¤**
           - ê²½ìŸ ë„êµ¬ ëŒ€ë¹„ ì¥ë‹¨ì  (ìµœì†Œ 5ê°œ ë„êµ¬)
           - ì •ëŸ‰ì  ì„±ëŠ¥ ë¹„êµ (ë²¤ì¹˜ë§ˆí¬ ë°ì´í„°)
           - TCO(Total Cost of Ownership) ë¶„ì„
           - ê¸°ìˆ  ìŠ¤íƒ í˜¸í™˜ì„± ë§¤íŠ¸ë¦­ìŠ¤
        
        4. **ë¯¸ë˜ ì „ë§** (3-5ë…„)
           - ê¸°ìˆ  ë¡œë“œë§µê³¼ ë°œì „ ë°©í–¥
           - ì˜ˆìƒë˜ëŠ” íŒ¨ëŸ¬ë‹¤ì„ ë³€í™”
           - íˆ¬ì ê°€ì¹˜ì™€ ìœ„í—˜ ìš”ì†Œ
           - ëŒ€ì²´ ê¸°ìˆ  ì¶œí˜„ ê°€ëŠ¥ì„±
        
        ëª¨ë“  ë¶„ì„ì€ ì‹¤ì œ ë°ì´í„°ì™€ ì‚¬ë¡€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°,
        ì¶”ì¸¡ì´ë‚˜ ì¼ë°˜ë¡ ì€ í”¼í•˜ê³  êµ¬ì²´ì ì¸ ê·¼ê±°ë¥¼ ì œì‹œí•˜ì„¸ìš”.
        """,
        
        "business_impact": """
        QA ê´€ë¦¬ìì™€ ê²½ì˜ì§„ì„ ìœ„í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ì„íŒ©íŠ¸ ë¶„ì„:
        
        1. **ROI ê³„ì‚°** (êµ¬ì²´ì ì¸ ìˆ«ì í¬í•¨)
           - ë„ì… ë¹„ìš© vs ì ˆê° íš¨ê³¼ (1ë…„, 3ë…„, 5ë…„)
           - ìƒì‚°ì„± í–¥ìƒ ì§€í‘œ (ê°œë°œ ì†ë„, ê²°í•¨ ê°ì†Œìœ¨)
           - í’ˆì§ˆ ê°œì„ ì— ë”°ë¥¸ ê³ ê° ë§Œì¡±ë„ ì˜í–¥
           - ì‹œì¥ ì¶œì‹œ ì‹œê°„ ë‹¨ì¶• íš¨ê³¼
        
        2. **ë¦¬ìŠ¤í¬ ë¶„ì„**
           - ë„ì… ì‹œ ì˜ˆìƒë˜ëŠ” ì¥ì• ë¬¼ê³¼ í•´ê²°ì±…
           - ì¡°ì§ ë³€í™” ê´€ë¦¬ ì „ëµ
           - ê¸°ìˆ  ë¶€ì±„ ì¦ê°€ ê°€ëŠ¥ì„±
           - ë²¤ë” ì¢…ì†ì„±ê³¼ ëŒ€ì•ˆ
        
        3. **ë‹¨ê³„ë³„ ë„ì… ì „ëµ**
           - Pilot â†’ PoC â†’ ì „ì‚¬ í™•ëŒ€ ë¡œë“œë§µ
           - ê° ë‹¨ê³„ë³„ ì„±ê³µ ì§€í‘œ(KPI)
           - í•„ìš”í•œ ì¸ë ¥ê³¼ êµìœ¡ ê³„íš
           - ì˜ˆì‚° ë°°ë¶„ê³¼ íƒ€ì„ë¼ì¸
        
        4. **ê²½ìŸì‚¬ ì‚¬ë¡€ ì—°êµ¬**
           - ìœ ì‚¬ ê¸°ì—…ì˜ ë„ì… ì‚¬ë¡€ (ìµœì†Œ 3ê°œ)
           - ì„±ê³µ/ì‹¤íŒ¨ ìš”ì¸ ë¶„ì„
           - Best Practiceì™€ êµí›ˆ
           - ìš°ë¦¬ ì¡°ì§ì— ì ìš© ì‹œ ê³ ë ¤ì‚¬í•­
        """,
        
        "practical_implementation": """
        ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì‹¤ë¬´ êµ¬í˜„ ê°€ì´ë“œ:
        
        1. **Day 1: ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ**
           ```bash
           # ì‹¤ì œ ì‹¤í–‰ ê°€ëŠ¥í•œ ëª…ë ¹ì–´ì™€ ìŠ¤í¬ë¦½íŠ¸
           # í™˜ê²½ ì„¤ì •ë¶€í„° ì²« í…ŒìŠ¤íŠ¸ ì‹¤í–‰ê¹Œì§€
           ```
        
        2. **Week 1: íŒŒì¼ëŸ¿ í”„ë¡œì íŠ¸**
           - ì‘ì€ ëª¨ë“ˆ ì„ ì • ê¸°ì¤€
           - ì´ˆê¸° í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„± ì˜ˆì‹œ
           - íŒ€ì› ì˜¨ë³´ë”© ì²´í¬ë¦¬ìŠ¤íŠ¸
           - ì¼ì¼ ì§„í–‰ ìƒí™© ì¶”ì  í…œí”Œë¦¿
        
        3. **Month 1: í†µí•©ê³¼ ìµœì í™”**
           - CI/CD íŒŒì´í”„ë¼ì¸ í†µí•© (Jenkins, GitLab, GitHub Actions)
           - í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œê°„ ìµœì í™” ê¸°ë²•
           - ë³‘ë ¬ ì‹¤í–‰ê³¼ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
           - ë¦¬í¬íŒ…ê³¼ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•
        
        4. **ì§€ì†ì  ê°œì„ **
           - ì£¼ê°„/ì›”ê°„ ë©”íŠ¸ë¦­ ë¦¬ë·° í…œí”Œë¦¿
           - í…ŒìŠ¤íŠ¸ ìœ ì§€ë³´ìˆ˜ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤
           - íŒ€ ì—­ëŸ‰ ê°œë°œ ë¡œë“œë§µ
           - ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬ì™€ ê¸°ì—¬ ë°©ë²•
        
        ê° ë‹¨ê³„ë§ˆë‹¤ ì‹¤ì œ ì½”ë“œ, ì„¤ì • íŒŒì¼, ìŠ¤í¬ë¦°ìƒ·ì„ í¬í•¨í•˜ì—¬
        ë”°ë¼í•˜ê¸°ë§Œ í•˜ë©´ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ ìƒì„¸íˆ ì„¤ëª…í•˜ì„¸ìš”.
        """,
        
        "trend_analysis": """
        QA ë¶„ì•¼ íŠ¸ë Œë“œì™€ ì—°ê²°í•œ ì¢…í•© ë¶„ì„:
        
        1. **í˜„ì¬ ìœ„ì¹˜ íŒŒì•…**
           - Gartner Hype Cycleì—ì„œì˜ ìœ„ì¹˜
           - ThoughtWorks Tech Radar í‰ê°€
           - Stack Overflow ê°œë°œì ì„¤ë¬¸ ìˆœìœ„
           - GitHub Stars/Fork íŠ¸ë Œë“œ
        
        2. **ê´€ë ¨ ìƒíƒœê³„ ë¶„ì„**
           - ì—°ê´€ ê¸°ìˆ  ìŠ¤íƒì˜ ë°œì „ (ìµœì†Œ 10ê°œ)
           - í†µí•© ê°€ëŠ¥í•œ ë„êµ¬ì™€ í”Œë«í¼
           - ì»¤ë®¤ë‹ˆí‹° í™œì„±ë„ì™€ ì„±ì¥ì„¸
           - ì£¼ìš” ì»¨íŠ¸ë¦¬ë·°í„°ì™€ ìŠ¤í°ì„œ
        
        3. **ì‚°ì—…ë³„ ì±„íƒ í˜„í™©**
           - ê¸ˆìœµ, í—¬ìŠ¤ì¼€ì–´, ì´ì»¤ë¨¸ìŠ¤ ë“± ì‚°ì—…ë³„ ì‚¬ë¡€
           - ê·œì œ ì¤€ìˆ˜ ìš”êµ¬ì‚¬í•­ ì¶©ì¡±ë„
           - ë³´ì•ˆê³¼ ì»´í”Œë¼ì´ì–¸ìŠ¤ ì§€ì›
           - ê¸€ë¡œë²Œ vs ë¡œì»¬ ì±„íƒ íŒ¨í„´
        
        4. **í–¥í›„ 5ë…„ ì „ë§**
           - ì˜ˆìƒ ì‹œì¥ ê·œëª¨ì™€ ì„±ì¥ë¥ 
           - í•„ìš”í•œ ìŠ¤í‚¬ì…‹ ë³€í™”
           - ìƒˆë¡œìš´ ì§ë¬´ì™€ ì—­í• 
           - êµìœ¡ê³¼ ì¸ì¦ í”„ë¡œê·¸ë¨
        
        ëª¨ë“  ë¶„ì„ì€ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜ë¥¼ ì¸ìš©í•˜ê³ ,
        ë‹¤ì–‘í•œ ê´€ì ì„ ê· í˜•ìˆê²Œ ì œì‹œí•˜ì„¸ìš”.
        """
    }
    
    # 3. ì½˜í…ì¸  í˜•ì‹ë³„ í”„ë¡¬í”„íŠ¸
    FORMAT_PROMPTS = {
        "case_study": """
        ì‹¤ì œ ê¸°ì—… ì‚¬ë¡€ ì—°êµ¬ í˜•ì‹ìœ¼ë¡œ ì‘ì„±:
        
        **ê¸°ì—… ë°°ê²½**
        - ì‚°ì—…: [ê¸ˆìœµ/ì´ì»¤ë¨¸ìŠ¤/í—¬ìŠ¤ì¼€ì–´ ë“±]
        - ê·œëª¨: [ì§ì› ìˆ˜, ë§¤ì¶œ, ì‚¬ìš©ì ìˆ˜]
        - ê¸°ìˆ  ìŠ¤íƒ: [ìƒì„¸í•œ í˜„ì¬ í™˜ê²½]
        - ë„ì „ ê³¼ì œ: [êµ¬ì²´ì ì¸ ë¬¸ì œ ìƒí™©]
        
        **ë„ì… ê³¼ì •**
        1. ì´ˆê¸° í‰ê°€ (2ì£¼)
           - PoC ë²”ìœ„ì™€ ì„±ê³µ ê¸°ì¤€
           - íŒ€ êµ¬ì„±ê³¼ ì—­í• 
           - ì´ˆê¸° íˆ¬ì ê·œëª¨
        
        2. íŒŒì¼ëŸ¿ ì‹¤í–‰ (1ê°œì›”)
           - ì„ ì •ëœ í”„ë¡œì íŠ¸ì™€ ì´ìœ 
           - ì§ë©´í•œ ë¬¸ì œì™€ í•´ê²° ê³¼ì •
           - ì¤‘ê°„ ê²°ê³¼ì™€ í”¼ë“œë°±
        
        3. í™•ëŒ€ ì ìš© (3-6ê°œì›”)
           - ë‹¨ê³„ë³„ ë¡¤ì•„ì›ƒ ì „ëµ
           - ë³€ê²½ ê´€ë¦¬ì™€ êµìœ¡
           - ê±°ë²„ë„ŒìŠ¤ ìˆ˜ë¦½
        
        **ê²°ê³¼ì™€ êµí›ˆ**
        - ì •ëŸ‰ì  ì„±ê³¼ (ê·¸ë˜í”„ì™€ ì°¨íŠ¸ í¬í•¨)
        - ì •ì„±ì  ë³€í™” (ì¸í„°ë·° ì¸ìš©)
        - ì‹¤íŒ¨ì™€ ê·¹ë³µ ê³¼ì •
        - ë‹¤ë¥¸ ê¸°ì—…ì„ ìœ„í•œ ì¡°ì–¸
        """,
        
        "interactive_tutorial": """
        ë‹¨ê³„ë³„ ì¸í„°ë™í‹°ë¸Œ íŠœí† ë¦¬ì–¼ í˜•ì‹:
        
        **ì‚¬ì „ ì¤€ë¹„ì‚¬í•­**
        â–¡ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ ì²´í¬
        â–¡ í•„ìš” ë„êµ¬ ì„¤ì¹˜ í™•ì¸
        â–¡ ìƒ˜í”Œ í”„ë¡œì íŠ¸ ë‹¤ìš´ë¡œë“œ
        â–¡ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
        
        **Step 1: ê¸°ë³¸ ì„¤ì • (15ë¶„)**
        ```bash
        # ëª…ë ¹ì–´ ì„¤ëª…ê³¼ í•¨ê»˜
        $ command --with-explanation
        ```
        
        âœ… ì²´í¬í¬ì¸íŠ¸: ì´ ë‹¨ê³„ì—ì„œ í™•ì¸í•´ì•¼ í•  ì‚¬í•­
        âš ï¸ ì£¼ì˜ì‚¬í•­: í”í•œ ì‹¤ìˆ˜ì™€ í•´ê²° ë°©ë²•
        ğŸ’¡ íŒ: íš¨ìœ¨ì„±ì„ ìœ„í•œ ì¶”ê°€ ì¡°ì–¸
        
        **Step 2: ì²« ë²ˆì§¸ í…ŒìŠ¤íŠ¸ ì‘ì„± (20ë¶„)**
        [ì½”ë“œ ì—ë””í„° ìŠ¤íƒ€ì¼ë¡œ ì‘ì„±]
        - ë¼ì¸ë³„ ì„¤ëª… í¬í•¨
        - ë‹¤ì–‘í•œ ì˜µì…˜ ì œì‹œ
        - ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ
        
        **ë„ì „ ê³¼ì œ**
        ğŸ¯ ê³¼ì œ 1: ê¸°ë³¸ ê¸°ëŠ¥ í™•ì¥í•˜ê¸°
        ğŸ¯ ê³¼ì œ 2: ì—£ì§€ ì¼€ì´ìŠ¤ ì²˜ë¦¬í•˜ê¸°
        ğŸ¯ ê³¼ì œ 3: ì„±ëŠ¥ ìµœì í™”í•˜ê¸°
        
        **ë‹¤ìŒ ë‹¨ê³„**
        - ì‹¬í™” í•™ìŠµ ìë£Œ ë§í¬
        - ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬ ë°©ë²•
        - í”„ë¡œì íŠ¸ ì•„ì´ë””ì–´
        """,
        
        "comparison_matrix": """
        ë„êµ¬/ê¸°ìˆ  ë¹„êµ ë§¤íŠ¸ë¦­ìŠ¤ í˜•ì‹:
        
        | ë¹„êµ í•­ëª© | ë„êµ¬ A | ë„êµ¬ B | ë„êµ¬ C | ìš°ë¦¬ì˜ ì„ íƒ |
        |---------|--------|--------|--------|------------|
        | **ê¸°ë³¸ ì •ë³´** |
        | ìµœì´ˆ ë¦´ë¦¬ìŠ¤ | 2018 | 2020 | 2019 | - |
        | í˜„ì¬ ë²„ì „ | 5.2.1 | 3.0.0 | 4.5.0 | - |
        | ë¼ì´ì„ ìŠ¤ | MIT | Apache 2.0 | GPL 3.0 | âœ… MIT ì„ í˜¸ |
        | **ê¸°ìˆ ì  íŠ¹ì„±** |
        | ì–¸ì–´ ì§€ì› | 15ê°œ | 8ê°œ | 12ê°œ | âœ… A (ê°€ì¥ ë§ìŒ) |
        | ì„±ëŠ¥ (ops/sec) | 10,000 | 15,000 | 8,000 | âœ… B (ìµœê³  ì„±ëŠ¥) |
        | ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ | 512MB | 256MB | 1GB | âœ… B (ìµœì†Œ ì‚¬ìš©) |
        | **ìƒíƒœê³„** |
        | GitHub Stars | 25.5k | 18.2k | 22.1k | âœ… A (ì¸ê¸°ë„) |
        | í”ŒëŸ¬ê·¸ì¸ ìˆ˜ | 500+ | 200+ | 350+ | âœ… A (í™•ì¥ì„±) |
        | ì»¤ë®¤ë‹ˆí‹° ê·œëª¨ | ëŒ€ê·œëª¨ | ì¤‘ê°„ | ì¤‘ê°„ | âœ… A (ì§€ì›) |
        | **ë¹„ìš©** |
        | ì´ˆê¸° ë„ì… | $0 | $0 | $0 | - |
        | ì—”í„°í”„ë¼ì´ì¦ˆ | $5k/ë…„ | $8k/ë…„ | $3k/ë…„ | âœ… C (ìµœì €ê°€) |
        | êµìœ¡ ë¹„ìš© | ë‚®ìŒ | ì¤‘ê°„ | ë†’ìŒ | âœ… A (ì‰¬ìš´ í•™ìŠµ) |
        | **ì¢…í•© í‰ê°€** |
        | ì ìˆ˜ (100ì ) | 85 | 82 | 78 | âœ… A ì„ íƒ |
        
        **ìƒì„¸ ë¶„ì„**
        ê° í•­ëª©ë³„ êµ¬ì²´ì ì¸ í…ŒìŠ¤íŠ¸ ë°©ë²•ê³¼ ê²°ê³¼...
        """
    }
    
    # 4. í•™ìŠµ ìˆ˜ì¤€ë³„ í”„ë¡¬í”„íŠ¸
    LEVEL_BASED_PROMPTS = {
        "beginner": """
        QAë¥¼ ì²˜ìŒ ì‹œì‘í•˜ëŠ” ì£¼ë‹ˆì–´ë¥¼ ìœ„í•œ ì¹œì ˆí•œ ì„¤ëª…:
        
        ğŸŒ± **ê¸°ì´ˆ ê°œë… ì„¤ëª…**
        - ì „ë¬¸ ìš©ì–´ëŠ” ì‰¬ìš´ ë§ë¡œ í’€ì–´ì„œ ì„¤ëª…
        - ì¼ìƒì ì¸ ë¹„ìœ ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´í•´ ë•ê¸°
        - ê·¸ë¦¼ê³¼ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì‹œê°í™”
        
        ğŸ“š **ë‹¨ê³„ë³„ í•™ìŠµ ê²½ë¡œ**
        1. ì²« ì£¼: ê¸°ë³¸ ê°œë… ì´í•´í•˜ê¸°
        2. ì²« ë‹¬: ê°„ë‹¨í•œ ì‹¤ìŠµ í”„ë¡œì íŠ¸
        3. 3ê°œì›”: ì‹¤ë¬´ í”„ë¡œì íŠ¸ ì°¸ì—¬
        4. 6ê°œì›”: ë…ë¦½ì ì¸ ì—…ë¬´ ìˆ˜í–‰
        
        âœï¸ **ì‹¤ìŠµ ì˜ˆì œ**
        - ë”°ë¼í•˜ê¸° ì‰¬ìš´ ë‹¨ìˆœí•œ ì˜ˆì œ
        - ê° ë‹¨ê³„ë§ˆë‹¤ ìŠ¤í¬ë¦°ìƒ· í¬í•¨
        - ì˜ˆìƒë˜ëŠ” ì˜¤ë¥˜ì™€ í•´ê²° ë°©ë²•
        
        ğŸ’ª **ë™ê¸°ë¶€ì—¬**
        - ì´ ê¸°ìˆ ì„ ë°°ìš°ë©´ ì–»ê²Œ ë  ê²ƒë“¤
        - ì‹¤ì œ ì£¼ë‹ˆì–´ ì„±ì¥ ìŠ¤í† ë¦¬
        - ì»¤ë¦¬ì–´ ë°œì „ ê°€ëŠ¥ì„±
        """,
        
        "intermediate": """
        2-5ë…„ ê²½ë ¥ QA ì—”ì§€ë‹ˆì–´ë¥¼ ìœ„í•œ ì‹¤ë¬´ ì¤‘ì‹¬ ê°€ì´ë“œ:
        
        ğŸ¯ **ì‹¤ë¬´ ì ìš© í¬ì¸íŠ¸**
        - í˜„ì¬ í”„ë¡œì íŠ¸ì— ì¦‰ì‹œ ì ìš© ê°€ëŠ¥í•œ ê¸°ë²•
        - íŒ€ ì „ì²´ ìƒì‚°ì„± í–¥ìƒ ë°©ë²•
        - ì¼ë°˜ì ì¸ ì•ˆí‹°íŒ¨í„´ê³¼ í•´ê²°ì±…
        
        ğŸ”§ **ê³ ê¸‰ ê¸°ëŠ¥ í™œìš©**
        - ìˆ¨ê²¨ì§„ ìœ ìš©í•œ ê¸°ëŠ¥ë“¤
        - ì„±ëŠ¥ ìµœì í™” í…Œí¬ë‹‰
        - ì»¤ìŠ¤í„°ë§ˆì´ì§•ê³¼ í™•ì¥
        
        ğŸ“Š **ì¸¡ì •ê³¼ ê°œì„ **
        - ì˜ë¯¸ ìˆëŠ” ë©”íŠ¸ë¦­ ì„ ì •
        - ê°œì„  íš¨ê³¼ ì¸¡ì • ë°©ë²•
        - ê²½ì˜ì§„ ë³´ê³ ì„œ ì‘ì„±ë²•
        
        ğŸš€ **ë‹¤ìŒ ë‹¨ê³„ë¡œ**
        - ì‹œë‹ˆì–´ë¡œ ì„±ì¥í•˜ê¸° ìœ„í•œ ìŠ¤í‚¬
        - ë¦¬ë”ì‹­ê³¼ ë©˜í† ë§
        - ê¸°ìˆ  ë¸”ë¡œê·¸ ì‘ì„±í•˜ê¸°
        """,
        
        "senior": """
        ì‹œë‹ˆì–´/ë¦¬ë“œ QAë¥¼ ìœ„í•œ ì „ëµì  ì¸ì‚¬ì´íŠ¸:
        
        ğŸ—ï¸ **ì•„í‚¤í…ì²˜ ë ˆë²¨ ê³ ë¯¼**
        - ëŒ€ê·œëª¨ ì‹œìŠ¤í…œ í’ˆì§ˆ ì „ëµ
        - ê¸°ìˆ  ë¶€ì±„ ê´€ë¦¬ì™€ ë¦¬íŒ©í† ë§
        - ì¥ê¸°ì  ê¸°ìˆ  ë¡œë“œë§µ ìˆ˜ë¦½
        
        ğŸ‘¥ **íŒ€ê³¼ ì¡°ì§**
        - QA ë¬¸í™” í™•ì‚° ì „ëµ
        - ê°œë°œíŒ€ê³¼ì˜ í˜‘ì—… ëª¨ë¸
        - ì¸ì¬ ì±„ìš©ê³¼ ìœ¡ì„±
        
        ğŸ’¼ **ë¹„ì¦ˆë‹ˆìŠ¤ ì„íŒ©íŠ¸**
        - C-ë ˆë²¨ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜
        - ì˜ˆì‚° í™•ë³´ì™€ ROI ì¦ëª…
        - ì‚°ì—… í‘œì¤€ê³¼ ê·œì œ ëŒ€ì‘
        
        ğŸŒ **ì»¤ë®¤ë‹ˆí‹° ê¸°ì—¬**
        - ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ ë¦¬ë”©
        - ì»¨í¼ëŸ°ìŠ¤ ë°œí‘œ
        - ì°¨ì„¸ëŒ€ ë¦¬ë” ë©˜í† ë§
        """
    }
    
    @staticmethod
    def combine_prompts(
        persona: str, 
        analysis_type: str, 
        format_type: str,
        level: str,
        context: Dict[str, Any]
    ) -> str:
        """ì—¬ëŸ¬ í”„ë¡¬í”„íŠ¸ë¥¼ ê²°í•©í•˜ì—¬ ìµœì í™”ëœ í”„ë¡¬í”„íŠ¸ ìƒì„±."""
        
        template = f"""
        {EnhancedPromptTemplates.PERSONA_PROMPTS.get(persona, "")}
        
        ë§¥ë½:
        - ê¸°ì‚¬ ì œëª©: {context.get('title', '')}
        - ìš”ì•½: {context.get('summary', '')}
        - ì¶”ê°€ ë°ì´í„°: {json.dumps(context.get('additional_data', {}), ensure_ascii=False)}
        
        {EnhancedPromptTemplates.ANALYSIS_PROMPTS.get(analysis_type, "")}
        
        ì‘ì„± í˜•ì‹:
        {EnhancedPromptTemplates.FORMAT_PROMPTS.get(format_type, "")}
        
        ëŒ€ìƒ ë…ì ìˆ˜ì¤€:
        {EnhancedPromptTemplates.LEVEL_BASED_PROMPTS.get(level, "")}
        
        ì¶”ê°€ ì§€ì¹¨:
        1. ëª¨ë“  ì£¼ì¥ì€ êµ¬ì²´ì ì¸ ë°ì´í„°ì™€ ì¶œì²˜ë¡œ ë’·ë°›ì¹¨í•˜ì„¸ìš”
        2. ì‹¤ì œ ì½”ë“œ ì˜ˆì‹œëŠ” í”„ë¡œë•ì…˜ ë ˆë²¨ë¡œ ì‘ì„±í•˜ì„¸ìš”
        3. í•œêµ­ QA ì—…ê³„ íŠ¹ì„±ì„ ê³ ë ¤í•˜ì—¬ í˜„ì§€í™”í•˜ì„¸ìš”
        4. SEOë¥¼ ìœ„í•œ í‚¤ì›Œë“œë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ í¬í•¨í•˜ì„¸ìš”
        5. ë…ìì˜ í–‰ë™ì„ ìœ ë„í•˜ëŠ” CTAë¥¼ í¬í•¨í•˜ì„¸ìš”
        
        ë°˜ë“œì‹œ ë‹¤ìŒ JSON êµ¬ì¡°ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
        {{
            "title": "SEO ìµœì í™”ëœ ë§¤ë ¥ì ì¸ ì œëª©",
            "meta_description": "ê²€ìƒ‰ ê²°ê³¼ì— í‘œì‹œë  ì„¤ëª… (155ì ì´ë‚´)",
            "main_content": "ë³¸ë¬¸ ë‚´ìš© (ë§ˆí¬ë‹¤ìš´ í˜•ì‹)",
            "key_takeaways": ["í•µì‹¬ í¬ì¸íŠ¸ 1", "í•µì‹¬ í¬ì¸íŠ¸ 2", "..."],
            "action_items": ["ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ í•­ëª©ë“¤"],
            "related_resources": [{{"title": "", "url": "", "description": ""}}],
            "engagement_hooks": ["ë…ì ì°¸ì—¬ë¥¼ ìœ ë„í•˜ëŠ” ì§ˆë¬¸ë“¤"]
        }}
        """
        
        return template.strip()


class PromptOptimizer:
    """í”„ë¡¬í”„íŠ¸ ì„±ëŠ¥ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ìµœì í™”í•˜ëŠ” í´ë˜ìŠ¤."""
    
    def __init__(self):
        self.performance_metrics = {}
        self.ab_test_results = {}
    
    def track_performance(
        self, 
        prompt_id: str, 
        metrics: Dict[str, float]
    ) -> None:
        """í”„ë¡¬í”„íŠ¸ ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì¶”ì ."""
        if prompt_id not in self.performance_metrics:
            self.performance_metrics[prompt_id] = []
        
        self.performance_metrics[prompt_id].append({
            "timestamp": datetime.now(),
            "metrics": metrics
        })
    
    def suggest_improvements(self, prompt_id: str) -> List[str]:
        """ì„±ëŠ¥ ë°ì´í„° ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ ê°œì„  ì œì•ˆ."""
        if prompt_id not in self.performance_metrics:
            return []
        
        suggestions = []
        metrics_history = self.performance_metrics[prompt_id]
        
        # í‰ê·  ì„±ëŠ¥ ê³„ì‚°
        avg_quality = sum(m["metrics"].get("quality", 0) for m in metrics_history) / len(metrics_history)
        avg_engagement = sum(m["metrics"].get("engagement", 0) for m in metrics_history) / len(metrics_history)
        
        if avg_quality < 70:
            suggestions.append("ë” êµ¬ì²´ì ì¸ ì˜ˆì‹œì™€ ë°ì´í„°ë¥¼ ìš”êµ¬í•˜ëŠ” í”„ë¡¬í”„íŠ¸ ì¶”ê°€")
        
        if avg_engagement < 50:
            suggestions.append("ë…ì ì°¸ì—¬ë¥¼ ìœ ë„í•˜ëŠ” ìš”ì†Œ (í€´ì¦ˆ, ì„¤ë¬¸, ê³¼ì œ) ì¶”ê°€")
        
        return suggestions
    
    def run_ab_test(
        self, 
        prompt_a: str, 
        prompt_b: str, 
        test_cases: List[Dict[str, Any]],
        provider: Any = None
    ) -> Dict[str, Any]:
        """ë‘ í”„ë¡¬í”„íŠ¸ ê°„ A/B í…ŒìŠ¤íŠ¸ ì‹¤í–‰."""
        results = {
            "prompt_a": {"scores": [], "avg": 0, "responses": []},
            "prompt_b": {"scores": [], "avg": 0, "responses": []},
            "winner": None,
            "confidence": 0.0
        }
        
        if not provider:
            # Providerê°€ ì—†ìœ¼ë©´ ì ìˆ˜ë§Œ ê³„ì‚° (ì‹¤ì œ API í˜¸ì¶œ ì—†ì´)
            for test_case in test_cases:
                # ê°„ë‹¨í•œ íœ´ë¦¬ìŠ¤í‹± ì ìˆ˜ ê³„ì‚°
                score_a = self._calculate_prompt_score(prompt_a, test_case)
                score_b = self._calculate_prompt_score(prompt_b, test_case)
                
                results["prompt_a"]["scores"].append(score_a)
                results["prompt_b"]["scores"].append(score_b)
        else:
            # ì‹¤ì œ Providerë¡œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            for test_case in test_cases:
                try:
                    # Prompt A í…ŒìŠ¤íŠ¸
                    item_a = test_case.copy()
                    item_a["summary"] = prompt_a
                    result_a = provider.generate(item_a)
                    score_a = self._evaluate_result(result_a, test_case)
                    results["prompt_a"]["scores"].append(score_a)
                    results["prompt_a"]["responses"].append(result_a.summary[:100])
                    
                    # Prompt B í…ŒìŠ¤íŠ¸
                    item_b = test_case.copy()
                    item_b["summary"] = prompt_b
                    result_b = provider.generate(item_b)
                    score_b = self._evaluate_result(result_b, test_case)
                    results["prompt_b"]["scores"].append(score_b)
                    results["prompt_b"]["responses"].append(result_b.summary[:100])
                except Exception as exc:
                    # ì˜¤ë¥˜ ë°œìƒ ì‹œ 0ì  ì²˜ë¦¬
                    results["prompt_a"]["scores"].append(0)
                    results["prompt_b"]["scores"].append(0)
        
        # í‰ê·  ì ìˆ˜ ê³„ì‚°
        if results["prompt_a"]["scores"]:
            results["prompt_a"]["avg"] = sum(results["prompt_a"]["scores"]) / len(results["prompt_a"]["scores"])
        if results["prompt_b"]["scores"]:
            results["prompt_b"]["avg"] = sum(results["prompt_b"]["scores"]) / len(results["prompt_b"]["scores"])
        
        # ìŠ¹ì ê²°ì •
        if results["prompt_a"]["avg"] > results["prompt_b"]["avg"]:
            results["winner"] = "prompt_a"
            results["confidence"] = (results["prompt_a"]["avg"] - results["prompt_b"]["avg"]) / max(results["prompt_a"]["avg"], 1)
        elif results["prompt_b"]["avg"] > results["prompt_a"]["avg"]:
            results["winner"] = "prompt_b"
            results["confidence"] = (results["prompt_b"]["avg"] - results["prompt_a"]["avg"]) / max(results["prompt_b"]["avg"], 1)
        else:
            results["winner"] = "tie"
        
        return results
    
    def _calculate_prompt_score(self, prompt: str, test_case: Dict[str, Any]) -> float:
        """í”„ë¡¬í”„íŠ¸ì˜ í’ˆì§ˆì„ ê°„ë‹¨íˆ í‰ê°€ (íœ´ë¦¬ìŠ¤í‹±)."""
        score = 0.0
        
        # í”„ë¡¬í”„íŠ¸ ê¸¸ì´ (ì ì ˆí•œ ê¸¸ì´ë©´ ì ìˆ˜)
        if 100 <= len(prompt) <= 2000:
            score += 20
        
        # êµ¬ì²´ì ì¸ ì§€ì‹œì‚¬í•­ í¬í•¨ ì—¬ë¶€
        if "êµ¬ì²´" in prompt or "ì˜ˆì‹œ" in prompt or "ì½”ë“œ" in prompt:
            score += 20
        
        # QA ê´€ë ¨ í‚¤ì›Œë“œ í¬í•¨
        qa_keywords = ["qa", "í…ŒìŠ¤íŠ¸", "í’ˆì§ˆ", "ìë™í™”", "test", "quality"]
        keyword_count = sum(1 for kw in qa_keywords if kw.lower() in prompt.lower())
        score += min(30, keyword_count * 5)
        
        # êµ¬ì¡°í™”ëœ í˜•ì‹ (ë²ˆí˜¸, í•­ëª© ë“±)
        if any(marker in prompt for marker in ["1.", "2.", "-", "*", "##"]):
            score += 15
        
        # JSON í˜•ì‹ ìš”êµ¬
        if "json" in prompt.lower() or "JSON" in prompt:
            score += 15
        
        return min(100.0, score)
    
    def _evaluate_result(self, qa_result: Any, test_case: Dict[str, Any]) -> float:
        """QA ê²°ê³¼ë¥¼ í‰ê°€í•˜ì—¬ ì ìˆ˜ ê³„ì‚°."""
        score = 0.0
        
        # Summary í’ˆì§ˆ
        if qa_result.summary and len(qa_result.summary) > 100:
            score += 20
        
        # QA Engineer Insights ì¡´ì¬
        if qa_result.qa_engineer_insights and len(qa_result.qa_engineer_insights) > 0:
            score += 20
        
        # Practical Guide ì¡´ì¬
        if qa_result.practical_guide and len(qa_result.practical_guide) > 0:
            score += 20
        
        # Q&A Pairs ì¡´ì¬
        if qa_result.qa_pairs and len(qa_result.qa_pairs) > 0:
            score += 20
        
        # Learning Roadmap ì¡´ì¬
        if qa_result.learning_roadmap and len(qa_result.learning_roadmap) > 0:
            score += 20
        
        return min(100.0, score)


# ì‚¬ìš© ì˜ˆì‹œ
if __name__ == "__main__":
    # ì»¨í…ìŠ¤íŠ¸ ì¤€ë¹„
    context = {
        "title": "Playwright 4.0 ì¶œì‹œ - AI ê¸°ë°˜ ìë™ ì¹˜ìœ  ê¸°ëŠ¥ ì¶”ê°€",
        "summary": "Microsoftê°€ Playwright 4.0ì„ ë°œí‘œí•˜ë©° AIë¥¼ í™œìš©í•œ ì…€ë ‰í„° ìë™ ì¹˜ìœ  ê¸°ëŠ¥ì„ ì„ ë³´ì˜€ìŠµë‹ˆë‹¤.",
        "additional_data": {
            "votes": 250,
            "comments": 45,
            "source": "GeekNews"
        }
    }
    
    # í”„ë¡¬í”„íŠ¸ ìƒì„±
    prompt = EnhancedPromptTemplates.combine_prompts(
        persona="automation_specialist",
        analysis_type="deep_technical",
        format_type="interactive_tutorial",
        level="intermediate",
        context=context
    )
    
    print(prompt)
